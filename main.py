import argparse
import asyncio
import subprocess
import sys
import threading
import time
import os
import signal # –î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç signal
from pathlib import Path
from datetime import datetime

from maxapi import Bot, Dispatcher, F
from maxapi.types import MessageCreated

# --- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ---
BOT_TOKEN = "f9LHodD0cOLsYEiupLdu2Je27BALs0CelP_lm1fV8CotCvsr6TUFIEm09vTzmgdQrsrmc4LtLNi3zdxTGn7y"
FRONTEND_DIR = Path("./frontend")
FRONTEND_PORT = 5173
STATE_FILE = "bot_state.txt"

bot = Bot(BOT_TOKEN)
dp = Dispatcher()

# --- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è ---
bot_is_running = False # –§–ª–∞–≥ —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞
was_running_before = False # –§–ª–∞–≥, –±—ã–ª –ª–∏ –±–æ—Ç –∑–∞–ø—É—â–µ–Ω –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–º —Ü–∏–∫–ª–µ

def get_bot_reply(text: str) -> str:
    """–§—É–Ω–∫—Ü–∏—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–∞ –±–æ—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–∫—Å—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è."""
    msg = text.strip().lower()

    # --- –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –∑–∞–¥–∞–Ω–∏–∏ ---
    if "–∑–∞–¥–∞–Ω–∏–µ" in msg or "–ø–æ–º–Ω–∏—à—å –∑–∞–¥–∞–Ω–∏–µ" in msg or "—á—Ç–æ —Ç—ã —É–º–µ–µ—à—å" in msg or "—Ü–µ–ª—å" in msg or "/–∑–∞–¥–∞–Ω–∏–µ" in msg:
        return (
            "üéØ **–¶–µ–ª—å –º–æ–µ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è:**\n"
            "–Ø - —á–∞—Ç-–±–æ—Ç –¥–ª—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã MAX, —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –¥–ª—è –ø–æ–º–æ—â–∏ –ª—é–¥—è–º —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏ –∑–¥–æ—Ä–æ–≤—å—è (–û–í–ó) –≤ –ø–æ–≤—Å–µ–¥–Ω–µ–≤–Ω–æ–π –∂–∏–∑–Ω–∏.\n\n"
            "üîç **–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (–ø–æ –∑–∞–¥–∞–Ω–∏—é):**\n"
            "- **–ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –æ–±—ä–µ–∫—Ç–æ–≤** –ø–æ –∫—Ä–∏—Ç–µ—Ä–∏—è–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ (–∫–∞—Ñ–µ, –ø–æ–ª–∏–∫–ª–∏–Ω–∏–∫–∏, —Ç–µ–∞—Ç—Ä—ã –∏ —Ç.–¥.)\n"
            "  - –¢–∏–ø –∏–Ω–≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏/–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π: –∫–æ–ª—è—Å–æ—á–Ω–∏–∫, —Å–ª–∞–±–æ–≤–∏–¥—è—â–∏–π, –≥–ª—É—Ö–æ–π, –∞—É—Ç–∏–∑–º –∏ –¥—Ä.\n"
            "  - –≠–ª–µ–º–µ–Ω—Ç—ã –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏: –ø–∞–Ω–¥—É—Å—ã, —à–∏—Ä–æ–∫–∏–µ –¥–≤–µ—Ä–∏, —Ç–∞–∫—Ç–∏–ª—å–Ω—ã–µ —É–∫–∞–∑–∞—Ç–µ–ª–∏, —Å—É—Ä–¥–æ–ø–µ—Ä–µ–≤–æ–¥ –∏ —Ç.–ø.\n"
            "- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≥–µ–æ–ª–æ–∫–∞—Ü–∏–µ–π** –¥–ª—è –ø–æ–∏—Å–∫–∞ –±–ª–∏–∂–∞–π—à–∏—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤.\n"
            "- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –æ—Ç–∑—ã–≤—ã –∏ —Ñ–æ—Ç–æ** –¥–ª—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏.\n"
            "- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≥–æ—Å. —Å–µ—Ä–≤–∏—Å–∞–º–∏** –¥–ª—è –ø–æ–¥–∞—á–∏ –∂–∞–ª–æ–± –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏—Ö —Å—Ç–∞—Ç—É—Å–∞.\n"
            "- **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**.\n"
            "- **–û–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –∏ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–æ–Ω–Ω—ã–π –º–æ–¥—É–ª—å** (–¥–æ–∫—É–º–µ–Ω—Ç—ã, —é—Ä. –ø–æ–º–æ—â—å).\n\n"
            "–ü–æ–∫–∞ —è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ, –Ω–æ —É–∂–µ –º–æ–≥—É –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –ø—Ä–æ—Å—Ç—ã–µ –∑–∞–ø—Ä–æ—Å—ã! –ü–æ–ø—Ä–æ–±—É–π—Ç–µ: */start*, */–∑–∞–¥–∞–Ω–∏–µ*."
        )

    # –ó–∞–≥–ª—É—à–∫–∞ –¥–ª—è –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
    return (
        f"–í—ã –Ω–∞–ø–∏—Å–∞–ª–∏: *¬´{text}¬ª*\n\n"
        "–Ø –ø–æ–∫–∞ –æ—Ç–≤–µ—á–∞—é –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º ‚Äî –Ω–æ —Å–∫–æ—Ä–æ –Ω–∞—É—á—É—Å—å –ø–æ–Ω–∏–º–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã! "
        "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ: */start*, */–∑–∞–¥–∞–Ω–∏–µ*."
    )

# --- –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start ---
@dp.message_created(F.message.body.text == "/start")
async def handle_start(event: MessageCreated):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start."""
    global bot_is_running, was_running_before

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–∞–π–ª —Å–æ—Å—Ç–æ—è–Ω–∏—è
    if os.path.exists(STATE_FILE):
        with open(STATE_FILE, 'r', encoding='utf-8') as f:
            last_state = f.read().strip()
        if last_state == "stopped":
            print("‚ö†Ô∏è  –ë–æ—Ç –±—ã–ª –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Ä–∞–Ω–µ–µ (—Ñ–∞–π–ª —Å–æ—Å—Ç–æ—è–Ω–∏—è).") # –î–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
            was_running_before = True
        else:
            print("‚ÑπÔ∏è  –§–∞–π–ª —Å–æ—Å—Ç–æ—è–Ω–∏—è –Ω–µ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é –æ—Å—Ç–∞–Ω–æ–≤–∫—É.") # –î–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
    else:
        print("‚ÑπÔ∏è  –§–∞–π–ª —Å–æ—Å—Ç–æ—è–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫?") # –î–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ "—Ä–∞–±–æ—Ç–∞–µ—Ç"
    bot_is_running = True

    # --- –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ---
    if was_running_before:
        await event.message.answer(
            "üéâ –ü—Ä–∏–≤–µ—Ç! –Ø —Å–Ω–æ–≤–∞ –≤ —Å—Ç—Ä–æ—é!\n"
            "–ë–æ—Ç –≤–µ—Ä–Ω—É–ª—Å—è –≤ —Ä–∞–±–æ—Ç—É –ø–æ—Å–ª–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è.\n"
            "–î–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏: —è –ø–æ–º–æ–≥–∞—é –Ω–∞—Ö–æ–¥–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Å—Ç–∞ –¥–ª—è –ª—é–¥–µ–π —Å –û–í–ó.\n"
            "–ù–∞–ø–∏—à–∏—Ç–µ */–∑–∞–¥–∞–Ω–∏–µ*, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å, —á—Ç–æ —è —É–º–µ—é –¥–µ–ª–∞—Ç—å."
        )
    else:
        await event.message.answer(
            "üéâ –ü—Ä–∏–≤–µ—Ç! –Ø –∑–∞–ø—É—â–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!\n"
            "–Ø - –±–æ—Ç, —Å–æ–∑–¥–∞–Ω–Ω—ã–π –¥–ª—è –ø–æ–º–æ—â–∏ –ª—é–¥—è–º —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏ –∑–¥–æ—Ä–æ–≤—å—è.\n"
            "–ù–∞–ø–∏—à–∏—Ç–µ */–∑–∞–¥–∞–Ω–∏–µ*, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å, —á—Ç–æ —è —É–º–µ—é –¥–µ–ª–∞—Ç—å."
        )

    # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ "–∑–∞–ø—É—â–µ–Ω" –≤ —Ñ–∞–π–ª
    try:
        with open(STATE_FILE, 'w', encoding='utf-8') as f:
            f.write("running")
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏ —Ñ–∞–π–ª–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è: {e}")

# --- –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—Å–µ—Ö –¥—Ä—É–≥–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π ---
@dp.message_created(F.message.body.text)
async def handle_message(event: MessageCreated):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—Ö–æ–¥—è—â–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (–∫—Ä–æ–º–µ /start)."""
    user_text = event.message.body.text
    bot_reply = get_bot_reply(user_text)
    try:
        await event.message.answer(bot_reply)
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è: {e}")

# --- –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è ---
def run_frontend():
    """–ó–∞–ø—É—Å–∫–∞–µ—Ç React-—Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ —á–µ—Ä–µ–∑ npm run dev"""
    if not FRONTEND_DIR.exists():
        print(f"‚ùå –ü–∞–ø–∫–∞ {FRONTEND_DIR} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –ª–µ–∂–∏—Ç –≤ ./frontend/")
        return False

    print(f"üìÅ –ó–∞–ø—É—Å–∫ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –∏–∑ {FRONTEND_DIR}...")
    try:
        proc = subprocess.Popen(
            ["npm", "run", "dev"],
            cwd=FRONTEND_DIR,
            stdout=subprocess.PIPE,
            stderr=subprocess.STDOUT,
            text=True,
            bufsize=1
        )

        for line in proc.stdout:
            print(f"‚öõÔ∏è  {line.strip()}")
            if f"http://localhost:{FRONTEND_PORT}" in line:
                print(f"\n‚úÖ –§—Ä–æ–Ω—Ç–µ–Ω–¥ –¥–æ—Å—Ç—É–ø–µ–Ω: http://localhost:{FRONTEND_PORT}")
                break

        return proc
    except FileNotFoundError:
        print("‚ùå npm –Ω–µ –Ω–∞–π–¥–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Node.js –∏ npm.")
        return None
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞: {e}")
        return None

async def run_bot():
    """–ó–∞–ø—É—Å–∫–∞–µ—Ç –±–æ—Ç–∞ –≤ MAX."""
    global bot_is_running, was_running_before

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–∞–π–ª —Å–æ—Å—Ç–æ—è–Ω–∏—è
    if os.path.exists(STATE_FILE):
        with open(STATE_FILE, 'r', encoding='utf-8') as f:
            last_state = f.read().strip()
        if last_state == "stopped":
            print("‚ö†Ô∏è  –ë–æ—Ç –±—ã–ª –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Ä–∞–Ω–µ–µ (—Ñ–∞–π–ª —Å–æ—Å—Ç–æ—è–Ω–∏—è).") # –î–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
            was_running_before = True
        else:
            print("‚ÑπÔ∏è  –§–∞–π–ª —Å–æ—Å—Ç–æ—è–Ω–∏—è –Ω–µ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é –æ—Å—Ç–∞–Ω–æ–≤–∫—É.") # –î–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
    else:
        print("‚ÑπÔ∏è  –§–∞–π–ª —Å–æ—Å—Ç–æ—è–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫?") # –î–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ "—Ä–∞–±–æ—Ç–∞–µ—Ç"
    bot_is_running = True

    # --- –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤—Å–µ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º –∏–ª–∏ –≤ –ª–æ–≥ –æ —Å—Ç–∞—Ä—Ç–µ ---
    # –¢–∞–∫ –∫–∞–∫ maxapi –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–∞–º–æ–º—É —Å–µ–±–µ –∏–ª–∏ –≤—Å–µ–º –±–µ–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞,
    # –º—ã –ø—Ä–æ—Å—Ç–æ –≤—ã–≤–æ–¥–∏–º –≤ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏.
    print("\nü§ñ –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞ –≤ —Ä–µ–∂–∏–º–µ polling...")

    try:
        # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ "–∑–∞–ø—É—â–µ–Ω" –≤ —Ñ–∞–π–ª
        with open(STATE_FILE, 'w', encoding='utf-8') as f:
            f.write("running")
        await dp.start_polling(bot)
    except KeyboardInterrupt:
        pass
    finally:
        # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ "–Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç"
        bot_is_running = False
        print("\nüõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ polling –±–æ—Ç–∞...")

# --- –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–∏–≥–Ω–∞–ª–æ–≤ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ ---
def signal_handler(signum, frame):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–∏–≥–Ω–∞–ª–æ–≤ SIGINT –∏ SIGTERM."""
    global bot_is_running
    if bot_is_running:
        print(f"\nüîÑ –ü–æ–ª—É—á–µ–Ω —Å–∏–≥–Ω–∞–ª {signum}, –±–æ—Ç –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è...") # –î–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
        # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ "–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
        try:
            with open(STATE_FILE, 'w', encoding='utf-8') as f:
                f.write("stopped")
        except Exception as e:
            print(f"–û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏ —Ñ–∞–π–ª–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è: {e}")
        # –ó–∞–≤–µ—Ä—à–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å
        sys.exit(0)

signal.signal(signal.SIGINT, signal_handler)  # Ctrl+C
signal.signal(signal.SIGTERM, signal_handler) # –°–∏–≥–Ω–∞–ª –æ—Å—Ç–∞–Ω–æ–≤–∫–∏

def start_bot_in_thread():
    """–ó–∞–ø—É—Å–∫–∞–µ—Ç –±–æ—Ç–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ (–¥–ª—è —Ä–µ–∂–∏–º–∞ 'all')."""
    def target():
        asyncio.run(run_bot())
    thread = threading.Thread(target=target, daemon=True)
    thread.start()
    return thread

# --- CLI ---
if __name__ == "__main__":
    parser = argparse.ArgumentParser(description="BotMax: —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ—Ç–æ–º –∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º")
    parser.add_argument(
        "--mode",
        choices=["bot", "dev", "all"],
        default="bot",
        help="bot ‚Äî —Ç–æ–ª—å–∫–æ –±–æ—Ç; dev ‚Äî —Ç–æ–ª—å–∫–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥; all ‚Äî –∏ —Ç–æ, –∏ –¥—Ä—É–≥–æ–µ"
    )
    args = parser.parse_args()

    mode = args.mode

    if mode == "dev":
        print("üé® –†–µ–∂–∏–º: –∑–∞–ø—É—Å–∫ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞")
        proc = run_frontend()
        if proc:
            try:
                proc.wait()
            except KeyboardInterrupt:
                print("\nüõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞...")
                proc.terminate()
                proc.wait()

    elif mode == "bot":
        print("ü§ñ –†–µ–∂–∏–º: –∑–∞–ø—É—Å–∫ –±–æ—Ç–∞")
        try:
            asyncio.run(run_bot())
        except KeyboardInterrupt:
            print("\nüõë –ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤—Ä—É—á–Ω—É—é (Ctrl+C).")

    elif mode == "all":
        print("üöÄ –†–µ–∂–∏–º: –±–æ—Ç + —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥")
        bot_thread = start_bot_in_thread()
        time.sleep(1)
        run_frontend()
        bot_thread.join()